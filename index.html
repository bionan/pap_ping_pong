<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        #jogo {
            background-color: black;
        }
    </style>

</head>

<body>

    <canvas id="jogo" width="640" height="480"></canvas>


    <script>

        var canvas = document.getElementById("jogo");

        var ctx = canvas.getContext("2d");

        var raquete1 = { x: 50, y: 50, alt: 100, larg: 10, vel: 10, pontos: 0 };

        var raquete2 = { x: canvas.width - 50, y: 150, alt: 100, larg: 10, vel: 10, pontos: 0 };

        var bola = { x: canvas.width / 2, y: canvas.height / 2, alt: 10, larg: 10, velx: 5, vely: -5 };

        var r1tecla = { cima: false, baixo: false };

        var r2tecla = { cima: false, baixo: false };

        document.addEventListener('keydown', teclaPressionada);
        document.addEventListener('keyup', teclaLiberada);

        setInterval(jogo, 20); 

        function jogo() {

            moveRaquetes();
            moveBola();
            testaColisao();
            atualizaPontos();
            desenha();

        }


        function moveRaquetes() {

            if (r1tecla.cima == true) {
                raquete1.y = raquete1.y - raquete1.vel;

                // raquete ultrapassou o limite superior? (y < 0)
                if (raquete1.y < 0) {
                    raquete1.y = 0;
                }

            } else if (r1tecla.baixo == true) {
                raquete1.y = raquete1.y + raquete1.vel;

                // raquete ultrapassou o limite inferior? ( y + altura > altura do canvas
                if (raquete1.y + raquete1.alt > canvas.height) {
                    raquete1.y = raquete1.y - raquete1.vel;
                }
            }

            // VERIFICAR SE RAQUETE2 PRECISA SER MOVIDA
            //
            if (r2tecla.cima == true) {

                raquete2.y = raquete2.y - raquete2.vel;

                if (raquete2.y < 0) {
                    raquete2.y = 0;
                }

            } else if (r2tecla.baixo == true) {

                raquete2.y = raquete2.y + raquete2.vel;

                if (raquete2.y + raquete2.alt > canvas.height) {
                    raquete2.y = raquete2.y - raquete2.vel;
                }
            }

        }

        function moveBola() {

            bola.x = bola.x + bola.velx;
            bola.y = bola.y + bola.vely;


            if (bola.y + bola.alt >= canvas.height || bola.y <= 0) {
                bola.vely = -bola.vely;
            }

        }

        function testaColisao() {

            if (existeColisao(raquete1, bola) || existeColisao(raquete2, bola)) {
                // alterar a direção da bola
                bola.velx = -bola.velx;
            }
        }

        function existeColisao(obj1, obj2) {

            var colisaoX = obj1.x + obj1.larg > obj2.x && obj1.x < obj2.x + obj2.larg;
            var colisaoY = obj1.y + obj1.alt > obj2.y && obj1.y < obj2.y + obj2.alt;

            return colisaoX && colisaoY;
        }

        function atualizaPontos() {

            if (bola.x <= 0) {
                // ponto para o jogador 2
                raquete2.pontos++;

                // reiniciar jogo
                bolaAoCentro();
            }

            if (bola.x + bola.larg >= canvas.width) {
                // ponto para o jogador 1
                raquete1.pontos++;
                bolaAoCentro();
            }

        }

        function bolaAoCentro() {
            bola.x = canvas.width / 2;
            bola.y = canvas.height / 2
        }

        function desenha() {

            // Limpar o canvas (tela do jogo)
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            placar = "Jogador 1: " + raquete1.pontos + " Jogador 2: " + raquete2.pontos;
            ctx.fillStyle = "white";
            ctx.font = "24px serif";
            ctx.textAlign = "center";
            ctx.fillText(placar, 300, 30);

            // Desenhar a raquete 1
            ctx.beginPath();
            ctx.fillStyle = "red";
            ctx.rect(raquete1.x, raquete1.y, raquete1.larg, raquete1.alt);
            ctx.fill();

            // Desenhar a raquete 2  
            ctx.beginPath();
            ctx.fillStyle = "blue";
            ctx.rect(raquete2.x, raquete2.y, raquete2.larg, raquete2.alt);
            ctx.fill();

            // Desenhar a bola
            ctx.beginPath();
            ctx.fillStyle = "white";
            ctx.rect(bola.x, bola.y, bola.larg, bola.alt);
            ctx.fill();

        }
        
        function teclaPressionada(e) {

            switch (e.code) {

                case 'ArrowUp':
                    r2tecla.cima = true;
                    break;

                case 'KeyW':
                    r1tecla.cima = true;
                    break;

                case 'ArrowDown':
                    r2tecla.baixo = true;
                    break;

                case 'KeyS':
                    r1tecla.baixo = true;
                    break;
            }
        }

        function teclaLiberada(e) {
            //console.log(e);
            switch (e.code) {


                case 'ArrowUp':
                    r2tecla.cima = false;
                    break;

                case 'KeyW':
                    r1tecla.cima = false;
                    break;


                case 'ArrowDown':
                    r2tecla.baixo = false;
                    break;
 
                case 'KeyS':
                    r1tecla.baixo = false;
                    break;

            }
        }

    </script>
</body>

</html>