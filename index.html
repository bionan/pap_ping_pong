<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        #jogo {
            background-color: black;
        }
    </style>

</head>

<body>

    <canvas id="jogo" width="640" height="480"></canvas>


    <script>

        var canvas = document.getElementById("jogo");
        var ctx = canvas.getContext("2d");

        console.log(canvas.width + ' ' + canvas.height);

        // criar o objeto raquete2 incialmente na posição x = 50
        // y = 50, altura 100px, largura 3px, velocidade 10px e 0 pontos marcados 
        var raquete1 = {x:50, y:50, alt:100, larg:3, vel:10, pontos:0};


        // criar o objeto raquete2 incialmente na posição x = 150
        // y = 150, altura 100px, largura 3px, velocidade 10px e 0 pontos marcados 
        var raquete2 = {x:150, y:150, alt:100, larg:3, vel:10, pontos:0};

        // criar a bola, inicialmente localizada no centro do canvas
        // com 10px de altura e largura, velocidade direção x de 5px e
        // velocidade direção y de -5px
        var bola = { x: canvas.width/2, y:canvas.height/2, alt:10, larg:10, velx:5, vely:-5 };

        var r1tecla = { esq:false, dir:false, cima:false, baixo: false};
        var r2tecla = { esq:false, dir:false, cima:false, baixo: false};

        document.addEventListener('keydown', teclaPressionada);
        document.addEventListener('keyup', teclaLiberada);

        setInterval(jogo,20);
 
        function jogo() {

            moveRaquetes();
            moveBola();
            testaColisao();
            atualizaMarcador();
            desenha();

        }
        

        function teclaPressionada(e) {
            //console.log(e.code);
            switch( e.code ) {

                // Verificar se a tecla ArrowRight (SetaDireita) foi pressionada
                case 'ArrowRight':
                    r2tecla.dir = true;
                    break;

                case 'KeyD' :
                    r1tecla.dir = true;
                    break;

                // Verificar se a tecla ArrowLeft (SetaEsquerda) foi pressionada
                // Se sim, atribuir o valor true a variável tecla_esq
                case 'ArrowLeft':
                    r2tecla.esq = true;
                    break;

                // Verificar se a tecla A (qual será o código da tecla A?) foi pressionada
                // Se sim, atribuir o valor true a variável tecla_a
                //
                // ESCREVA O CÓDIGO NAS LINHAS SEGUINTES
                case 'KeyA' :
                    r1tecla.esq = true;
                    break;

                // Verificar se a tecla ArrowUp (SetaCima) foi pressionada
                // Se sim, atribuir o valor true a variável tecla_cima               
                case 'ArrowUp':
                    r2tecla.cima = true;
                    break;

                // Verificar se a tecla W (qual será o código da tecla W?) foi pressionada
                // Se sim, atribuir o valor true a variável tecla_w
                //
                // ESCREVA O CÓDIGO NAS LINHAS SEGUINTES  
                case 'KeyW' : 
                    r1tecla.cima = true;
                    break;                 

                // Verificar se a tecla ArrowDown (SetaBaixo) foi pressionada
                // Se sim, atribuir o valor true a variável tecla_baixo        
                case 'ArrowDown':
                    r2tecla.baixo = true;
                    break;

                // Verificar se a tecla S (qual será o código da tecla S?) foi pressionada
                // Se sim, atribuir o valor true a variável tecla_s
                //
                // ESCREVA O CÓDIGO NAS LINHAS SEGUINTES    
                case 'KeyS' :
                    r1tecla.baixo = true;
                    break;   
            }
            //move();
        }

        function teclaLiberada(e) {
            //console.log(e);
            switch( e.code ) {

                // Verificar se tecla ArrowRight libertada
                // Se sim atribuir false a tecla_dir
                case 'ArrowRight':
                    r2tecla.dir = false;
                    break;

                // Verificar se tecla D libertada
                // Se sim atribuir false a variável tecla_d                  
                //
                // ESCREVA O CÓDIGO NAS LINHAS SEGUINTES   
                case 'KeyD' :
                    r1tecla.dir = false;
                    break; 

                case 'ArrowLeft':
                    r2tecla.esq = false;
                    break;

                // Verificar se tecla A libertada
                // Se sim atribuir false a variável tecla_a                 
                //
                // ESCREVA O CÓDIGO NAS LINHAS SEGUINTES    
                case 'KeyA' :
                    r1tecla.esq = false;
                    break;


                case 'ArrowUp':
                    r2tecla.cima = false;
                    break;

                // Verificar se tecla W libertada
                // Se sim atribuir false a variável tecla_w                 
                //
                // ESCREVA O CÓDIGO NAS LINHAS SEGUINTES   
                case 'KeyW' :
                    r1tecla.cima = false;
                    break;                    


                case 'ArrowDown':
                    r2tecla.baixo = false;
                    break;

                // Verificar se tecla S libertada
                // Se sim atribuir false a variável tecla_s                
                //
                // ESCREVA O CÓDIGO NAS LINHAS SEGUINTES    
                case 'KeyS' :
                    r1tecla.baixo = false;
                    break;

            }
        }

        function desenha() {

            // Limpar o canvas (tela do jogo)
            ctx.clearRect(0,0,canvas.width, canvas.height);
            
            mostrador = "Jogador 1: " + raquete1.pontos + " Jogador 2: " + raquete2.pontos;
            ctx.fillStyle = "white";
            ctx.font = "24px serif";
            ctx.textAlign = "center";
            ctx.fillText(mostrador,300,30);
            
            // Desenhar a com a cor vermelho
            // a raquete1 com 10px de largura e 50px de altura
            ctx.beginPath();
            ctx.fillStyle = "red";
            ctx.rect(raquete1.x, raquete1.y, raquete1.larg, raquete1.alt);
            ctx.fill();

            // Desenhar a com a cor vermelho
            // a raquete2 com 10px de largura e 50px de altura
            //
            // ESCREVA O CÓDIGO NAS LINHAS SEGUINTES  
            ctx.beginPath();
            ctx.fillStyle = "blue";
            ctx.rect(raquete2.x, raquete2.y, raquete2.larg, raquete2.alt);
            ctx.fill();

            // Desenhar a bola
            ctx.beginPath();
            ctx.fillStyle = "white";
            ctx.rect(bola.x, bola.y, bola.larg, bola.alt);
            ctx.fill();
            
        }

        function moveRaquetes() {

            // Verificar se a raquete1 deve ser movida
            // e se permance dentro do campo de jogo
            //
            if ( r1tecla.dir == true ) {

                raquete1.x += raquete1.vel;
                
                if ( raquete1.x + raquete2.larg > canvas.width ) {
                    raquete1.x -= raquete1.vel;
                }
                
            } else if ( r1tecla.esq == true ) {

                raquete1.x -= raquete1.vel;

                if ( raquete1.x < 0 ) {
                    raquete1.x = 0;
                }
            }
          
            if ( r1tecla.cima == true ) {
                raquete1.y -= raquete1.vel;

                // raquete ultrapassou o limite superior? (y < 0)
                if ( raquete1.y < 0 ) {
                    raquete1.y = 0;
                }
                   
            } else if ( r1tecla.baixo == true ) {
                raquete1.y += raquete1.vel;

                // raquete ultrapassou o limite inferior? ( y + altura > altura do canvas
                if ( raquete1.y + raquete1.alt > canvas.height ) {
                    raquete1.y -= raquete1.vel;
                }
            }

            // Verificar se a raquete2 deve ser movida
            // e se permance dentro do campo de jogo
            //
            if ( r2tecla.dir == true) {
                raquete2.x += raquete2.vel;

                if ( raquete2.x + raquete2.larg > canvas.width ) {
                    raquete2.x -= raquete2.vel;
                }

            } else if ( r2tecla.esq == true) {
                
                raquete2.x -= raquete2.vel;

                if ( raquete2.x < 0 ) {
                    raquete2.x = 0;
                }
            } 
            
            if ( r2tecla.cima == true) {

                raquete2.y -= raquete2.vel;

                if (raquete2.y < 0 ) {
                    raquete2.y = 0;
                }

            } else if ( r2tecla.baixo == true) {
                
                raquete2.y += raquete2.vel;

                if ( raquete2.y + raquete2.alt > canvas.height ) {
                    raquete2.y  -= raquete2.vel;
                }
            }

            
        }

        //
        // Retorna true se há colisão e false caso não haja colisão
        //
        function existeColisao(obj1, obj2) {

            var colisaoX = obj1.x + obj1.larg > obj2.x && obj1.x < obj2.x + obj2.larg;
            var colisaoY = obj1.y + obj1.alt > obj2.y && obj1.y < obj2.y + obj2.alt;

            return colisaoX && colisaoY;
        }
      
        function bolaAoCentro() {
            bola.x = canvas.width/2;
            bola.y = canvas.height/2
        }

        function moveBola() {

            bola.x += bola.velx;
            bola.y += bola.vely;

            // Obrigar a bola a ficar dentro dos limite 
            // do campo de jogo
            //
            if ( bola.x < 0 || bola.x > canvas.width ) {
                bola.velx = -bola.velx;
            }
            if ( bola.y > canvas.height || bola.y < 0 ) {
                bola.vely = -bola.vely;
            }

        }

        function testaColisao() {

            if ( existeColisao(raquete1,bola) || existeColisao(raquete2,bola) ) {
                // alterar a direção da bola
                bola.velx = -bola.velx;
            }
        }
  
        function atualizaMarcador() {

            if ( bola.x < 0 ) {
                // ponto para o jogador 2
                raquete2.pontos++;

                // reiniciar jogo
                bolaAoCentro();
            }

            if ( bola.x > canvas.width ) {
                // ponto para o jogador 1
                raquete1.pontos++;
                bolaAoCentro();
            }

        }
  
  </script>
</body>
</html>